<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Descargar Audio de YouTube</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <form method="POST" id="downloadForm">
        <label for="url">URL:</label>
        <input type="text" id="url" name="url" autofocus required>
        <button type="submit">Siguiente</button>
    </form>

    <div id="fileNameForm" style="display: none;">
        <form id="fileNameInput">
            <label for="fileName">Nombre del archivo:</label>
            <input type="text" id="fileName" name="fileName" required>
            <button type="submit">Descargar</button>
        </form>
    </div>

    <script>
        document.getElementById('downloadForm').addEventListener('submit', function(event) {
            event.preventDefault();
            validarURL();
        });

        function validarURL() {
            var url = document.getElementById('url').value.trim();

            if (!url) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Por favor, ingrese una URL válida.'
                });
                return false;
            }

            // Verificar si la URL es válida (puedes agregar tu propia lógica de validación aquí)

            // Si la URL es válida, mostrar el formulario para ingresar el nombre del archivo
            document.getElementById('downloadForm').style.display = 'none';
            document.getElementById('fileNameForm').style.display = 'block';

            return false;
        }

        document.getElementById('fileNameInput').addEventListener('submit', function(event) {
            event.preventDefault();
            descargarAudio();
        });

        function descargarAudio() {
            var url = document.getElementById('url').value.trim();
            var fileName = document.getElementById('fileName').value.trim();

            // Construir el enlace de descarga directa con el nombre de archivo especificado
            var downloadLink = '/descargar_audio?url=' + encodeURIComponent(url) + '&fileName=' + encodeURIComponent(fileName);
            
            // Mostrar alerta cuando se inicie la descarga
            Swal.fire({
                icon: 'info',
                title: 'Iniciando descarga...',
                text: 'La descarga se está iniciando.'
            });

            // Simular un clic en el enlace de descarga
            var anchor = document.createElement('a');
            anchor.href = downloadLink;
            anchor.download = fileName + '.mp3'; // Asegúrate de agregar la extensión del archivo

            anchor.click();

            // Mostrar alerta cuando la descarga se complete correctamente
            Swal.fire({
                icon: 'success',
                title: 'Descarga completada',
                text: 'La descarga se ha completado con éxito.'
            }).then((result) => {
                // Refrescar la página después de la descarga
                window.location.reload();
            });

            return false;
        }
    </script>
</body>
</html>
